(self.webpackChunk=self.webpackChunk||[]).push([[6342],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return u}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=d(n),u=o,m=h["".concat(l,".").concat(u)]||h[u]||c[u]||r;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var d=2;d<r;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},5778:function(e,t,n){"use strict";n.d(t,{s:function(){return o}});var a=n(7294),o=function(e){var t=e.children,n=e.title,o=void 0===n?"Detailed Explanation":n;return a.createElement("details",{className:"detailed-explanation"},a.createElement("summary",null,a.createElement("h4",null,o)),t)}},4431:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return i},metadata:function(){return s},toc:function(){return l},default:function(){return p}});var a=n(2122),o=n(9756),r=(n(7294),n(3905)),i=(n(5778),{id:"part-5-ui-react",title:"Redux Fundamentals, Part 5: UI and React",sidebar_label:"UI and React",hide_title:!1,description:"The official Redux Fundamentals tutorial: learn how to use Redux with React"}),s={unversionedId:"tutorials/fundamentals/part-5-ui-react",id:"tutorials/fundamentals/part-5-ui-react",isDocsHomePage:!1,title:"Redux Fundamentals, Part 5: UI and React",description:"The official Redux Fundamentals tutorial: learn how to use Redux with React",source:"@site/../docs/tutorials/fundamentals/part-5-ui-and-react.md",sourceDirName:"tutorials/fundamentals",slug:"/tutorials/fundamentals/part-5-ui-react",permalink:"/tutorials/fundamentals/part-5-ui-react",version:"current",sidebar_label:"UI and React",frontMatter:{id:"part-5-ui-react",title:"Redux Fundamentals, Part 5: UI and React",sidebar_label:"UI and React",hide_title:!1,description:"The official Redux Fundamentals tutorial: learn how to use Redux with React"},sidebar:"docs",previous:{title:"Redux Fundamentals, Part 4: Store",permalink:"/tutorials/fundamentals/part-4-store"},next:{title:"Redux Fundamentals, Part 6: Async Logic and Data Fetching",permalink:"/tutorials/fundamentals/part-6-async-logic"}},l=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",children:[]},{value:"Integrating Redux with a UI",id:"integrating-redux-with-a-ui",children:[{value:"Basic Redux and UI Integration",id:"basic-redux-and-ui-integration",children:[]}]},{value:"Using Redux with React",id:"using-redux-with-react",children:[{value:"Designing the Component Tree",id:"designing-the-component-tree",children:[]},{value:"Reading State from the Store with <code>useSelector</code>",id:"reading-state-from-the-store-with-useselector",children:[]},{value:"Dispatching Actions with <code>useDispatch</code>",id:"dispatching-actions-with-usedispatch",children:[]},{value:"Passing the Store with <code>Provider</code>",id:"passing-the-store-with-provider",children:[]}]},{value:"React-Redux Patterns",id:"react-redux-patterns",children:[{value:"Global State, Component State, and Forms",id:"global-state-component-state-and-forms",children:[]},{value:"Using Multiple Selectors in a Component",id:"using-multiple-selectors-in-a-component",children:[]},{value:"Selecting Data in List Items by ID",id:"selecting-data-in-list-items-by-id",children:[]}]},{value:"\u4f60\u5b66\u5230\u4e86",id:"\u4f60\u5b66\u5230\u4e86",children:[]},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",children:[]}],d={toc:l};function p(e){var t=e.components,n=(0,o.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u4f60\u5c06\u5b66\u5230")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"How a Redux store works with a UI"),(0,r.kt)("li",{parentName:"ul"},"How to use Redux with React")))),(0,r.kt)("h2",{id:"\u7b80\u4ecb"},"\u7b80\u4ecb"),(0,r.kt)("p",null,"In ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/fundamentals/part-4-store"},"Part 4: Store"),", we saw how to create a Redux store, dispatch actions, and read the current state. We also looked at how a store works inside, how enhancers and middleware let us customize the store with additional abilities, and how to add the Redux DevTools to let us see what's happening inside our app as actions are dispatched."),(0,r.kt)("p",null,"In this section, we'll add a User Interface for our todo app. We'll see how Redux works with a UI layer overall, and we'll specifically cover how Redux works together with React."),(0,r.kt)("h2",{id:"integrating-redux-with-a-ui"},"Integrating Redux with a UI"),(0,r.kt)("p",null,"Redux is a standalone JS library. As we've already seen, you can create and use a Redux store even if you don't have a user interface set up. This also means that ",(0,r.kt)("strong",{parentName:"p"},"you can use Redux with any UI framework")," (or even without ",(0,r.kt)("em",{parentName:"p"},"any")," UI framework), and use it on both client and server. You can write Redux apps with React, Vue, Angular, Ember, jQuery, or vanilla JavaScript."),(0,r.kt)("p",null,"That said, ",(0,r.kt)("strong",{parentName:"p"},"Redux was specifically designed to work well with ",(0,r.kt)("a",{parentName:"strong",href:"https://reactjs.org"},"React")),". React lets you describe your UI as a function of your state, and Redux contains state and updates it in response to actions."),(0,r.kt)("p",null,"Because of that, we'll use React for this tutorial as we build our todo app, and cover the basics of how to use React with Redux."),(0,r.kt)("p",null,"Before we get to that part, let's take a quick look at how Redux interacts with a UI layer in general."),(0,r.kt)("h3",{id:"basic-redux-and-ui-integration"},"Basic Redux and UI Integration"),(0,r.kt)("p",null,"Using Redux with any UI layer requires a few consistent steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a Redux store"),(0,r.kt)("li",{parentName:"ol"},"Subscribe to updates"),(0,r.kt)("li",{parentName:"ol"},"Inside the subscription callback:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Get the current store state"),(0,r.kt)("li",{parentName:"ol"},"Extract the data needed by this piece of UI"),(0,r.kt)("li",{parentName:"ol"},"Update the UI with the data"))),(0,r.kt)("li",{parentName:"ol"},"If necessary, render the UI with initial state"),(0,r.kt)("li",{parentName:"ol"},"Respond to UI inputs by dispatching Redux actions")),(0,r.kt)("p",null,"Let's go back to the ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/fundamentals/part-1-overview"},"the counter app example we saw in Part 1")," and see how it follows those steps:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// 1) Create a new Redux store with the `createStore` function\nconst store = Redux.createStore(counterReducer)\n\n// 2) Subscribe to redraw whenever the data changes in the future\nstore.subscribe(render)\n\n// Our \"user interface\" is some text in a single HTML element\nconst valueEl = document.getElementById('value')\n\n// 3) When the subscription callback runs:\nfunction render() {\n  // 3.1) Get the current store state\n  const state = store.getState()\n  // 3.2) Extract the data you want\n  const newValue = state.value.toString()\n\n  // 3.3) Update the UI with the new value\n  valueEl.innerHTML = newValue\n}\n\n// 4) Display the UI with the initial store state\nrender()\n\n// 5) Dispatch actions based on UI inputs\ndocument.getElementById('increment').addEventListener('click', function () {\n  store.dispatch({ type: 'counter/incremented' })\n})\n")),(0,r.kt)("p",null,"No matter what UI layer you're using, ",(0,r.kt)("strong",{parentName:"p"},"Redux works this same way with every UI"),". The actual implementations are typically a bit more complicated to help optimize performance, but it's the same steps each time."),(0,r.kt)("p",null,'Since Redux is a separate library, there are different "binding" libraries to help you use Redux with a given UI framework. Those UI binding libraries handle the details of subscribing to the store and efficiently updating the UI as state changes, so that you don\'t have to write that code yourself.'),(0,r.kt)("h2",{id:"using-redux-with-react"},"Using Redux with React"),(0,r.kt)("p",null,"The official ",(0,r.kt)("a",{parentName:"p",href:"https://react-redux.js.org"},(0,r.kt)("strong",{parentName:"a"},"React-Redux UI bindings library"))," is a separate package from the Redux core. You'll need to install that in addition as well:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"npm install react-redux\n")),(0,r.kt)("p",null,"(If you don't use npm, you may grab the latest UMD build from unpkg (either a ",(0,r.kt)("a",{parentName:"p",href:"https://unpkg.com/react-redux@latest/dist/react-redux.js"},"development")," or a ",(0,r.kt)("a",{parentName:"p",href:"https://unpkg.com/react-redux@latest/dist/react-redux.min.js"},"production")," build). The UMD build exports a global called ",(0,r.kt)("inlineCode",{parentName:"p"},"window.ReactRedux")," if you add it to your page via a ",(0,r.kt)("inlineCode",{parentName:"p"},"<script>")," tag.)"),(0,r.kt)("p",null,"For this tutorial, we'll cover the most important patterns and examples you need to use React and Redux together, and see how they work in practice as part of our todo app."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"See ",(0,r.kt)("strong",{parentName:"p"},"the official React-Redux docs at ",(0,r.kt)("a",{parentName:"strong",href:"https://react-redux.js.org"},"https://react-redux.js.org"))," for a complete guide on how to use Redux and React together, and reference documentation on the React-Redux APIs."))),(0,r.kt)("h3",{id:"designing-the-component-tree"},"Designing the Component Tree"),(0,r.kt)("p",null,"Much like we ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/fundamentals/part-3-state-actions-reducers#designing-the-state-structure"},"designed the state structure")," based on requirements, we can also design the overall set of UI components and how they related to each other in the application."),(0,r.kt)("p",null,"Based on ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/fundamentals/part-3-state-actions-reducers#defining-requirements"},"the list of business requirements for the app"),", at a minimum we're going to need this set of components:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"<App>")),": the root component that renders everything else.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"<Header>")),': contains the "new todo" text input and the "complete all todos" checkbox'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"<TodoList>")),": a list of all currently visible todo items, based on the filtered results",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"<TodoListItem>")),": a single todo list item, with a checkbox that can be clicked to toggle the todo's completed status, and a color category selector"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"<Footer>")),": Shows the number of active todos and controls for filtering the list based on completed status and color category")))),(0,r.kt)("p",null,"Beyond this basic component structure, we could potentially divide the components up in several different ways. For example, the ",(0,r.kt)("inlineCode",{parentName:"p"},"<Footer>")," component ",(0,r.kt)("em",{parentName:"p"},"could")," be one larger component, or it could have multiple smaller components inside like ",(0,r.kt)("inlineCode",{parentName:"p"},"<CompletedTodos>"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"<StatusFilter>"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"<ColorFilters>"),". There's no single right way to divide these, and you'll find that it may be better to write larger components or split things into many smaller components depending on your situation."),(0,r.kt)("p",null,"For now, we'll start with this small list of components to keep things easier to follow. On that note, since we assume that ",(0,r.kt)("a",{parentName:"p",href:"https://reactjs.org"},"you already know React"),", ",(0,r.kt)("strong",{parentName:"p"},"we're going to skip past the details of how to write the layout code for these components and focus on how to actually use the React-Redux library in your React components"),"."),(0,r.kt)("p",null,"Here's the initial React UI of this app looks like before we start adding any Redux-related logic:"),(0,r.kt)("iframe",{class:"codesandbox",src:"https://codesandbox.io/embed/github/reduxjs/redux-fundamentals-example-app/tree/checkpoint-3-initialUI/?fontsize=14&hidenavigation=1&theme=dark&view=preview&runonclick=1",title:"redux-fundamentals-example-app",allow:"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"}),(0,r.kt)("h3",{id:"reading-state-from-the-store-with-useselector"},"Reading State from the Store with ",(0,r.kt)("inlineCode",{parentName:"h3"},"useSelector")),(0,r.kt)("p",null,"We know that we need to be able to show a list of todo items. Let's start by creating a ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoList>")," component that can read the list of todos from the store, loop over them, and show one ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoListItem>")," component for each todo entry."),(0,r.kt)("p",null,"You should be familiar with ",(0,r.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/hooks-state.html"},"React hooks like ",(0,r.kt)("inlineCode",{parentName:"a"},"useState")),", which can be called in React function components to give them access to React state values. React also lets us write ",(0,r.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/hooks-custom.html"},"custom hooks"),", which let us extract reusable hooks to add our own behavior on top of React's built-in hooks."),(0,r.kt)("p",null,"Like many other libraries, React-Redux includes ",(0,r.kt)("a",{parentName:"p",href:"https://react-redux.js.org/api/hooks"},"its own custom hooks"),", which you can use in your own components. The React-Redux hooks give your React component the ability to talk to the Redux store by reading state and dispatching actions."),(0,r.kt)("p",null,"The first React-Redux hook that we'll look at is the ",(0,r.kt)("a",{parentName:"p",href:"https://react-redux.js.org/api/hooks#useselector"},(0,r.kt)("strong",{parentName:"a"},(0,r.kt)("inlineCode",{parentName:"strong"},"useSelector")," hook")),", which ",(0,r.kt)("strong",{parentName:"p"},"lets your React components read data from the Redux store"),"."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," accepts a single function, which we call a ",(0,r.kt)("strong",{parentName:"p"},"selector")," function. ",(0,r.kt)("strong",{parentName:"p"},"A selector is a function that takes the entire Redux store state as its argument, reads some value from the state, and returns that result"),"."),(0,r.kt)("p",null,"For example, we know that our todo app's Redux state keeps the array of todo items as ",(0,r.kt)("inlineCode",{parentName:"p"},"state.todos"),". We can write a small selector function that returns that todos array:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const selectTodos = state => state.todos\n")),(0,r.kt)("p",null,'Or, maybe we want to find out how many todos are currently marked as "completed":'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const selectTotalCompletedTodos = state => {\n  const completedTodos = state.todos.filter(todo => todo.completed)\n  return completedTodos.length\n}\n")),(0,r.kt)("p",null,"So, ",(0,r.kt)("strong",{parentName:"p"},"selectors can return values from the Redux store state, and also return ",(0,r.kt)("em",{parentName:"strong"},"derived")," values based on that state as well"),"."),(0,r.kt)("p",null,"Let's read the array of todos into our ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoList>")," component. First, we'll import the ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," hook from the ",(0,r.kt)("inlineCode",{parentName:"p"},"react-redux")," library, then call it with a selector function as its argument:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/features/todos/TodoList.js"',title:'"src/features/todos/TodoList.js"'},"import React from 'react'\n// highlight-next-line\nimport { useSelector } from 'react-redux'\nimport TodoListItem from './TodoListItem'\n\n// highlight-next-line\nconst selectTodos = state => state.todos\n\nconst TodoList = () => {\n  // highlight-next-line\n  const todos = useSelector(selectTodos)\n\n  // since `todos` is an array, we can loop over it\n  const renderedListItems = todos.map(todo => {\n    return <TodoListItem key={todo.id} todo={todo} />\n  })\n\n  return <ul className=\"todo-list\">{renderedListItems}</ul>\n}\n\nexport default TodoList\n")),(0,r.kt)("p",null,"The first time the ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoList>")," component renders, the ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," hook will call ",(0,r.kt)("inlineCode",{parentName:"p"},"selectTodos")," and pass in the ",(0,r.kt)("em",{parentName:"p"},"entire")," Redux state object. Whatever the selector returns will be returned by the hook to your component. So, the ",(0,r.kt)("inlineCode",{parentName:"p"},"const todos")," in our component will end up holding the same ",(0,r.kt)("inlineCode",{parentName:"p"},"state.todos")," array inside our Redux store state."),(0,r.kt)("p",null,"But, what happens if we dispatch an action like ",(0,r.kt)("inlineCode",{parentName:"p"},"{type: 'todos/todoAdded'}"),"? The Redux state will be updated by the reducer, but our component needs to know that something has changed so that it can re-render with the new list of todos."),(0,r.kt)("p",null,"We know that we can call ",(0,r.kt)("inlineCode",{parentName:"p"},"store.subscribe()")," to listen for changes to the store, so we ",(0,r.kt)("em",{parentName:"p"},"could")," try writing the code to subscribe to the store in every component. But, that would quickly get very repetitive and hard to handle."),(0,r.kt)("p",null,"Fortunately, ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"useSelector")," automatically subscribes to the Redux store for us!")," That way, any time an action is dispatched, it will call its selector function again right away. ",(0,r.kt)("strong",{parentName:"p"},"If the value returned by the selector changes from the last time it ran, ",(0,r.kt)("inlineCode",{parentName:"strong"},"useSelector")," will force our component to re-render with the new data"),". All we have to do is call ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector()")," once in our component, and it does the rest of the work for us."),(0,r.kt)("p",null,"However, there's a very important thing to remember here:"),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"useSelector")," compares its results using strict ",(0,r.kt)("inlineCode",{parentName:"strong"},"===")," reference comparisons, so the component will re-render any time the selector result is a new reference!")," This means that if you create a new reference in your selector and return it, your component could re-render ",(0,r.kt)("em",{parentName:"p"},"every")," time an action has been dispatched, even if the data really isn't different."))),(0,r.kt)("p",null,"For example, passing this selector to ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," will cause the component to ",(0,r.kt)("em",{parentName:"p"},"always")," re-render, because ",(0,r.kt)("inlineCode",{parentName:"p"},"array.map()")," always returns a new array reference:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// Bad: always returning a new reference\nconst selectTodoDescriptions = state => {\n  // This creates a new array reference!\n  return state.todos.map(todo => todo.text)\n}\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"We'll talk about one way to fix this issue later in this section. We'll also talk about how you can improve performance and avoid unnecessary re-renders using \"memoized\" selector function in ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/fundamentals/part-7-standard-patterns"},"Part 7: Standard Redux Patterns"),"."))),(0,r.kt)("p",null,"It's also worth noting that we don't have to write a selector function as a separate variable. You can write a selector function directly inside the call to ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector"),", like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const todos = useSelector(state => state.todos)\n")),(0,r.kt)("h3",{id:"dispatching-actions-with-usedispatch"},"Dispatching Actions with ",(0,r.kt)("inlineCode",{parentName:"h3"},"useDispatch")),(0,r.kt)("p",null,"We now know how to read data from the Redux store into our components. But, how can we dispatch actions to the store from a component? We know that outside of React, we can call ",(0,r.kt)("inlineCode",{parentName:"p"},"store.dispatch(action)"),". Since we don't have access to the store in a component file, we need some way to get access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch")," function by itself inside our components."),(0,r.kt)("p",null,"The React-Redux ",(0,r.kt)("a",{parentName:"p",href:"https://react-redux.js.org/api/hooks#usedispatch"},(0,r.kt)("strong",{parentName:"a"},(0,r.kt)("inlineCode",{parentName:"strong"},"useDispatch")," hook"))," gives us the store's ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch")," method as its result. (In fact, the implementation of the hook really is ",(0,r.kt)("inlineCode",{parentName:"p"},"return store.dispatch"),".)"),(0,r.kt)("p",null,"So, we can call ",(0,r.kt)("inlineCode",{parentName:"p"},"const dispatch = useDispatch()")," in any component that needs to dispatch actions, and then call ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch(someAction)")," as needed."),(0,r.kt)("p",null,"Let's try that in our ",(0,r.kt)("inlineCode",{parentName:"p"},"<Header>")," component. We know that we need to let the user type in some text for a new todo item, and then dispatch a ",(0,r.kt)("inlineCode",{parentName:"p"},"{type: 'todos/todoAdded'}")," action containing that text."),(0,r.kt)("p",null,"We'll write a typical React form component that uses ",(0,r.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/forms.html#controlled-components"},'"controlled inputs"')," to let the user type in the form text. Then, when the user presses the Enter key specifically, we'll dispatch that action."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/features/header/Header.js"',title:'"src/features/header/Header.js"'},"import React, { useState } from 'react'\n// highlight-next-line\nimport { useDispatch } from 'react-redux'\n\nconst Header = () => {\n  const [text, setText] = useState('')\n  // highlight-next-line\n  const dispatch = useDispatch()\n\n  const handleChange = e => setText(e.target.value)\n\n  const handleKeyDown = e => {\n    const trimmedText = e.target.value.trim()\n    // If the user pressed the Enter key:\n    if (e.key === 'Enter' && trimmedText) {\n      // highlight-start\n      // Dispatch the \"todo added\" action with this text\n      dispatch({ type: 'todos/todoAdded', payload: trimmedText })\n      // highlight-end\n      // And clear out the text input\n      setText('')\n    }\n  }\n\n  return (\n    <input\n      type=\"text\"\n      placeholder=\"What needs to be done?\"\n      autoFocus={true}\n      value={text}\n      onChange={handleChange}\n      onKeyDown={handleKeyDown}\n    />\n  )\n}\n\nexport default Header\n")),(0,r.kt)("h3",{id:"passing-the-store-with-provider"},"Passing the Store with ",(0,r.kt)("inlineCode",{parentName:"h3"},"Provider")),(0,r.kt)("p",null,"Our components can now read state from the store, and dispatch actions to the store. However, we're still missing something. Where and how are the React-Redux hooks finding the right Redux store? A hook is a JS function, so it can't automatically import a store from ",(0,r.kt)("inlineCode",{parentName:"p"},"store.js")," by itself."),(0,r.kt)("p",null,"Instead, we have to specifically tell React-Redux what store we want to use in our components. We do this by ",(0,r.kt)("strong",{parentName:"p"},"rendering a ",(0,r.kt)("inlineCode",{parentName:"strong"},"<Provider>")," component around our entire ",(0,r.kt)("inlineCode",{parentName:"strong"},"<App>"),", and passing the Redux store as a prop to ",(0,r.kt)("inlineCode",{parentName:"strong"},"<Provider>")),". After we do this once, every component in the application will be able to access the Redux store if needs to."),(0,r.kt)("p",null,"Let's add that to our main ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/index.js"',title:'"src/index.js"'},"import React from 'react'\nimport ReactDOM from 'react-dom'\n// highlight-next-line\nimport { Provider } from 'react-redux'\n\nimport App from './App'\nimport store from './store'\n\nReactDOM.render(\n  // highlight-start\n  // Render a `<Provider>` around the entire `<App>`,\n  // and pass the Redux store to as a prop\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  // highlight-end\n  document.getElementById('root')\n)\n")),(0,r.kt)("p",null,"That covers the key parts of using React-Redux with React:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Call the ",(0,r.kt)("inlineCode",{parentName:"li"},"useSelector")," hook to read data in React components"),(0,r.kt)("li",{parentName:"ul"},"Call the ",(0,r.kt)("inlineCode",{parentName:"li"},"useDispatch")," hook to dispatch actions in React components"),(0,r.kt)("li",{parentName:"ul"},"Put ",(0,r.kt)("inlineCode",{parentName:"li"},"<Provider store={store}>")," around your entire ",(0,r.kt)("inlineCode",{parentName:"li"},"<App>")," component so that other components can talk to the store")),(0,r.kt)("p",null,"We should now be able to actually interact with the app! Here's the working UI so far:"),(0,r.kt)("iframe",{class:"codesandbox",src:"https://codesandbox.io/embed/github/reduxjs/redux-fundamentals-example-app/tree/checkpoint-4-initialHooks/?fontsize=14&hidenavigation=1&theme=dark&runonclick=1",title:"redux-fundamentals-example-app",allow:"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"}),(0,r.kt)("p",null,"Now, let's look at a couple more ways we can use these together in our todo app."),(0,r.kt)("h2",{id:"react-redux-patterns"},"React-Redux Patterns"),(0,r.kt)("h3",{id:"global-state-component-state-and-forms"},"Global State, Component State, and Forms"),(0,r.kt)("p",null,'By now you might be wondering, "Do I always have to put all my app\'s state into the Redux store?"'),(0,r.kt)("p",null,"The answer is ",(0,r.kt)("strong",{parentName:"p"},"NO. Global state that is needed across the app should go in the Redux store. State that's only needed in one place should be kept in component state.")),(0,r.kt)("p",null,"A good example of this is the ",(0,r.kt)("inlineCode",{parentName:"p"},"<Header>")," component we wrote earlier. We ",(0,r.kt)("em",{parentName:"p"},"could")," keep the current text input string in the Redux store, by dispatching an action in the input's ",(0,r.kt)("inlineCode",{parentName:"p"},"onChange")," handler and keeping it in our reducer. But, that doesn't give us any benefit. The only place that text string is used is here, in the ",(0,r.kt)("inlineCode",{parentName:"p"},"<Header>")," component."),(0,r.kt)("p",null,"So, it makes sense to keep that value in a ",(0,r.kt)("inlineCode",{parentName:"p"},"useState")," hook here in the ",(0,r.kt)("inlineCode",{parentName:"p"},"<Header>")," component."),(0,r.kt)("p",null,"Similarly, if we had a boolean flag called ",(0,r.kt)("inlineCode",{parentName:"p"},"isDropdownOpen"),", no other components in the app would care about that - it should really stay local to this component."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("strong",{parentName:"p"},"In a React + Redux app, your global state should go in the Redux store, and your local state should stay in React components.")),(0,r.kt)("p",{parentName:"div"},"If you're not sure where to put something, here are some common rules of thumb for determining what kind of data should be put into Redux:"),(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"Do other parts of the application care about this data?"),(0,r.kt)("li",{parentName:"ul"},"Do you need to be able to create further derived data based on this original data?"),(0,r.kt)("li",{parentName:"ul"},"Is the same data being used to drive multiple components?"),(0,r.kt)("li",{parentName:"ul"},"Is there value to you in being able to restore this state to a given point in time (ie, time travel debugging)?"),(0,r.kt)("li",{parentName:"ul"},"Do you want to cache the data (ie, use what's in state if it's already there instead of re-requesting it)?"),(0,r.kt)("li",{parentName:"ul"},"Do you want to keep this data consistent while hot-reloading UI components (which may lose their internal state when swapped)?")))),(0,r.kt)("p",null,"This is also a good example of how to think about forms in Redux in general. ",(0,r.kt)("strong",{parentName:"p"},"Most form state probably shouldn't be kept in Redux.")," Instead, keep the data in your form components as you're editing it, and then dispatch Redux actions to update the store when the user is done."),(0,r.kt)("h3",{id:"using-multiple-selectors-in-a-component"},"Using Multiple Selectors in a Component"),(0,r.kt)("p",null,"Right now only our ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoList>")," component is reading data from the store. Let's see what it might look like for the ",(0,r.kt)("inlineCode",{parentName:"p"},"<Footer>")," component to start reading some data as well."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"<Footer>")," needs to know three different pieces of information:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"How many completed todos there are"),(0,r.kt)("li",{parentName:"ul"},'The current "status" filter value'),(0,r.kt)("li",{parentName:"ul"},'The current list of selected "color" category filters')),(0,r.kt)("p",null,"How can we read these values into the component?"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"We can call ",(0,r.kt)("inlineCode",{parentName:"strong"},"useSelector")," multiple times within one component"),". In fact, this is actually a good idea - ",(0,r.kt)("strong",{parentName:"p"},"each call to ",(0,r.kt)("inlineCode",{parentName:"strong"},"useSelector")," should always return the smallest amount of state possible"),"."),(0,r.kt)("p",null,"We already saw how to write a selector that counts completed todos earlier. For the filters values, both the status filter value and the color filters values live in the ",(0,r.kt)("inlineCode",{parentName:"p"},"state.filters")," slice. Since this component needs both of them, we can select the entire ",(0,r.kt)("inlineCode",{parentName:"p"},"state.filters")," object."),(0,r.kt)("p",null,"As we mentioned earlier, we could put all the input handling directly into ",(0,r.kt)("inlineCode",{parentName:"p"},"<Footer>"),", or we could split it out into separate components like ",(0,r.kt)("inlineCode",{parentName:"p"},"<StatusFilter>"),". To keep this explanation shorter, we'll skip the exact details of writing the input handling and assume we've got smaller separate components that are given some data and change handler callbacks as props."),(0,r.kt)("p",null,"Given that assumption, the React-Redux parts of the component might look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/features/footer/Footer.js"',title:'"src/features/footer/Footer.js"'},"import React from 'react'\n// highlight-next-line\nimport { useSelector } from 'react-redux'\n\nimport { availableColors, capitalize } from '../filters/colors'\nimport { StatusFilters } from '../filters/filtersSlice'\n\n// Omit other footer components\n\nconst Footer = () => {\n  // highlight-start\n  const todosRemaining = useSelector(state => {\n    const uncompletedTodos = state.todos.filter(todo => !todo.completed)\n    return uncompletedTodos.length\n  })\n\n  const { status, colors } = useSelector(state => state.filters)\n  // highlight-end\n\n  // omit placeholder change handlers\n\n  return (\n    <footer className=\"footer\">\n      <div className=\"actions\">\n        <h5>Actions</h5>\n        <button className=\"button\">Mark All Completed</button>\n        <button className=\"button\">Clear Completed</button>\n      </div>\n\n      <RemainingTodos count={todosRemaining} />\n      <StatusFilter value={status} onChange={onStatusChange} />\n      <ColorFilters value={colors} onChange={onColorChange} />\n    </footer>\n  )\n}\n\nexport default Footer\n")),(0,r.kt)("h3",{id:"selecting-data-in-list-items-by-id"},"Selecting Data in List Items by ID"),(0,r.kt)("p",null,"Currently, our ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoList>")," is reading the entire ",(0,r.kt)("inlineCode",{parentName:"p"},"state.todos")," array and passing the actual todo objects as a prop to each ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoListItem>")," component."),(0,r.kt)("p",null,"This works, but there's a potential performance problem."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Changing one todo object means creating copies of both the todo and the ",(0,r.kt)("inlineCode",{parentName:"li"},"state.todos")," array, and each copy is a new reference in memory"),(0,r.kt)("li",{parentName:"ul"},"When ",(0,r.kt)("inlineCode",{parentName:"li"},"useSelector")," sees a new reference as its result, it forces its component to re-render"),(0,r.kt)("li",{parentName:"ul"},"So, any time ",(0,r.kt)("em",{parentName:"li"},"one")," todo object is updated (like clicking it to toggle its completed status), the whole ",(0,r.kt)("inlineCode",{parentName:"li"},"<TodoList>")," parent component will re-render"),(0,r.kt)("li",{parentName:"ul"},"Then, ",(0,r.kt)("a",{parentName:"li",href:"https://blog.isquaredsoftware.com/2020/05/blogged-answers-a-mostly-complete-guide-to-react-rendering-behavior/#standard-render-behavior"},"because React re-renders all child components recursively by default"),", it also means that ",(0,r.kt)("em",{parentName:"li"},"all")," of the ",(0,r.kt)("inlineCode",{parentName:"li"},"<TodoListItem>")," components will re-render, even though most of them didn't actually change at all!")),(0,r.kt)("p",null,"Re-rendering components isn't bad - that's how React knows if it needs to update the DOM. But, re-rendering lots of components when nothing has actually changed can potentially get too slow if the list is too big."),(0,r.kt)("p",null,"There's a couple ways we could try to fix this. One option is to ",(0,r.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/react-api.html#reactmemo"},"wrap all the ",(0,r.kt)("inlineCode",{parentName:"a"},"<TodoListItem>")," components in ",(0,r.kt)("inlineCode",{parentName:"a"},"React.memo()")),", so that they only re-render when their props actually change. This is often a good choice for improving performance, but it does require that the child component always receives the same props until something really changes. Since each ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoListItem>")," component is receiving a todo item as a prop, only one of them should actually get a changed prop and have to re-render."),(0,r.kt)("p",null,"Another option is to have the ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoList>")," component only read an array of todo IDs from the store, and pass those IDs as props to the child ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoListItem>")," components. Then, each ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoListItem>")," can use that ID to find the right todo object it needs."),(0,r.kt)("p",null,"Let's give that a shot."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/features/todos/TodoList.js"',title:'"src/features/todos/TodoList.js"'},"import React from 'react'\nimport { useSelector } from 'react-redux'\nimport TodoListItem from './TodoListItem'\n\n// highlight-next-line\nconst selectTodoIds = state => state.todos.map(todo => todo.id)\n\nconst TodoList = () => {\n  // highlight-next-line\n  const todoIds = useSelector(selectTodoIds)\n\n  const renderedListItems = todoIds.map(todoId => {\n    // highlight-next-line\n    return <TodoListItem key={todoId} id={todoId} />\n  })\n\n  return <ul className=\"todo-list\">{renderedListItems}</ul>\n}\n")),(0,r.kt)("p",null,"This time, we only select an array of todo IDs from the store in ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoList>"),", and we pass each ",(0,r.kt)("inlineCode",{parentName:"p"},"todoId")," as an ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," prop to the child ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoListItem>"),"s."),(0,r.kt)("p",null,"Then, in ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoListItem>"),", we can use that ID value to read our todo item. We can also update ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoListItem>"),' to dispatch the "toggled" action based on the todo\'s ID.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/features/todos/TodoListItem.js"',title:'"src/features/todos/TodoListItem.js"'},"import React from 'react'\n// highlight-next-line\nimport { useSelector, useDispatch } from 'react-redux'\n\nimport { availableColors, capitalize } from '../filters/colors'\n\n// highlight-start\nconst selectTodoById = (state, todoId) => {\n  return state.todos.find(todo => todo.id === todoId)\n}\n// highlight-end\n\n// Destructure `props.id`, since we only need the ID value\nconst TodoListItem = ({ id }) => {\n  // Call our `selectTodoById` with the state _and_ the ID value\n  // highlight-next-line\n  const todo = useSelector(state => selectTodoById(state, id))\n  const { text, completed, color } = todo\n\n  // highlight-next-line\n  const dispatch = useDispatch()\n\n  // highlight-start\n  const handleCompletedChanged = () => {\n    dispatch({ type: 'todos/todoToggled', payload: todo.id })\n  }\n  // highlight-end\n\n  // omit other change handlers\n  // omit other list item rendering logic and contents\n\n  return (\n    <li>\n      <div className=\"view\">{/* omit other rendering output */}</div>\n    </li>\n  )\n}\n\nexport default TodoListItem\n")),(0,r.kt)("p",null,"There's a problem with this, though. We said earlier that ",(0,r.kt)("strong",{parentName:"p"},"returning new array references in selectors causes components to re-render every time"),", and right now we're returning a new IDs array in ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoListItem>"),". In this case, the ",(0,r.kt)("em",{parentName:"p"},"contents")," of the IDs array should be the same if we're toggling a todo, because we're still showing the same todo items - we haven't added or deleted any. But, the array ",(0,r.kt)("em",{parentName:"p"},"containing")," those IDs is a new reference, so ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoList>")," will re-render when it really doesn't need to."),(0,r.kt)("p",null,"One possible solution to this is to change how ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," compares its values to see if they've changed. ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," can take a comparison function as its second argument. A comparison function is called with the old and new values, and returns ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," if they're considered the same. If they're the same, ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," won't make the component re-render."),(0,r.kt)("p",null,"React-Redux has a ",(0,r.kt)("inlineCode",{parentName:"p"},"shallowEqual")," comparison function we can use to check if the items ",(0,r.kt)("em",{parentName:"p"},"inside")," the array are still the same. Let's try that:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/features/todos/TodoList.js"',title:'"src/features/todos/TodoList.js"'},"import React from 'react'\n// highlight-next-line\nimport { useSelector, shallowEqual } from 'react-redux'\nimport TodoListItem from './TodoListItem'\n\n// highlight-next-line\nconst selectTodoIds = state => state.todos.map(todo => todo.id)\n\nconst TodoList = () => {\n  // highlight-next-line\n  const todoIds = useSelector(selectTodoIds, shallowEqual)\n\n  const renderedListItems = todoIds.map(todoId => {\n    return <TodoListItem key={todoId} id={todoId} />\n  })\n\n  return <ul className=\"todo-list\">{renderedListItems}</ul>\n}\n")),(0,r.kt)("p",null,"Now, if we toggle a todo item, the list of IDs will be considered the same, and ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoList>")," won't have to re-render. The one ",(0,r.kt)("inlineCode",{parentName:"p"},"<TodoListItem>")," will get an updated todo object and re-render, but all the rest of them will still have the existing todo object and not have to re-render at all."),(0,r.kt)("p",null,"As mentioned earlier, you can also use a specialized kind of selector function called ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/fundamentals/part-7-standard-patterns"},'a "memoized selector"')," to help improve component rendering, and we'll look at how to use those in another section."),(0,r.kt)("h2",{id:"\u4f60\u5b66\u5230\u4e86"},"\u4f60\u5b66\u5230\u4e86"),(0,r.kt)("p",null,"We now have a working todo app! Our app creates a store, passes the store to the React UI layer using ",(0,r.kt)("inlineCode",{parentName:"p"},"<Provider>"),", and then calls ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"useDispatch")," to talk to the store in our React components."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Try implementing the rest of the missing UI features on your own! Here's a list of the things you'll need to add:"),(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"In ",(0,r.kt)("inlineCode",{parentName:"li"},"<TodoListItem>")," component, use the ",(0,r.kt)("inlineCode",{parentName:"li"},"useDispatch")," hook to dispatch actions to for changing the color category and deleting the todo"),(0,r.kt)("li",{parentName:"ul"},"In ",(0,r.kt)("inlineCode",{parentName:"li"},"<Footer>"),", use the ",(0,r.kt)("inlineCode",{parentName:"li"},"useDispatch")," hook to dispatch actions for marking all todos as completed, clearing completed todos, and changing the filter values.")),(0,r.kt)("p",{parentName:"div"},"We'll cover implementing the filters in ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/fundamentals/part-7-standard-patterns"},"Part 7: Standard Redux Patterns"),"."))),(0,r.kt)("p",null,"Let's see how the app looks now, including the components and sections we skipped to keep this shorter:"),(0,r.kt)("iframe",{class:"codesandbox",src:"https://codesandbox.io/embed/github/reduxjs/redux-fundamentals-example-app/tree/checkpoint-5-uiAllActions/?fontsize=14&hidenavigation=1&theme=dark&runonclick=1",title:"redux-fundamentals-example-app",allow:"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"}),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u603b\u7ed3")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Redux stores can be used with any UI layer"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"UI code always subscribes to the store, gets the latest state, and redraws itself"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"React-Redux is the official Redux UI bindings library for React"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"React-Redux is installed as a separate ",(0,r.kt)("inlineCode",{parentName:"li"},"react-redux")," package"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"strong"},"useSelector")," hook lets React components read data from the store"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Selector functions take the entire store ",(0,r.kt)("inlineCode",{parentName:"li"},"state")," as an argument, and return a value based on that state"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"useSelector")," calls its selector function and returns the result from the selector"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"useSelector")," subscribes to the store, and re-runs the selector each time an action is dispatched."),(0,r.kt)("li",{parentName:"ul"},"Whenever the selector result changes, ",(0,r.kt)("inlineCode",{parentName:"li"},"useSelector")," forces the component to re-render with the new data"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"strong"},"useDispatch")," hook lets React components dispatch actions to the store"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"useDispatch")," returns the actual ",(0,r.kt)("inlineCode",{parentName:"li"},"store.dispatch")," function"),(0,r.kt)("li",{parentName:"ul"},"You can call ",(0,r.kt)("inlineCode",{parentName:"li"},"dispatch(action)")," as needed inside your components"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"strong"},"<Provider>")," component makes the store available to other React components"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Render ",(0,r.kt)("inlineCode",{parentName:"li"},"<Provider store={store}>")," around your entire ",(0,r.kt)("inlineCode",{parentName:"li"},"<App>"))))))),(0,r.kt)("h2",{id:"\u4e0b\u4e00\u6b65"},"\u4e0b\u4e00\u6b65"),(0,r.kt)("p",null,"Now that our UI is working, it's time to see how to make our Redux app talk to a server. In ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/fundamentals/part-6-async-logic"},"Part 6: Async Logic"),", we'll talk about how asynchronous logic like timeouts and AJAX calls fit into the Redux data flow."))}p.isMDXComponent=!0}}]);