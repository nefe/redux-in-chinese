(self.webpackChunk=self.webpackChunk||[]).push([[4490],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return d},kt:function(){return u}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function A(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),l=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=l(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=A(e,["components","mdxType","originalType","parentName"]),p=l(a),u=i,h=p["".concat(s,".").concat(u)]||p[u]||c[u]||r;return a?n.createElement(h,o(o({ref:t},d),{},{components:a})):n.createElement(h,o({ref:t},d))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=p;var A={};for(var s in t)hasOwnProperty.call(t,s)&&(A[s]=t[s]);A.originalType=e,A.mdxType="string"==typeof e?e:i,o[1]=A;for(var l=2;l<r;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},5778:function(e,t,a){"use strict";a.d(t,{s:function(){return i}});var n=a(7294),i=function(e){var t=e.children,a=e.title,i=void 0===a?"Detailed Explanation":a;return n.createElement("details",{className:"detailed-explanation"},n.createElement("summary",null,n.createElement("h4",null,i)),t)}},1709:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return o},metadata:function(){return A},toc:function(){return s},default:function(){return d}});var n=a(2122),i=a(9756),r=(a(7294),a(3905)),o=(a(5778),{id:"part-4-store",title:"Redux Fundamentals, Part 4: Store",sidebar_label:"Store",hide_title:!1,description:"The official Redux Fundamentals tutorial: learn how to create and use a Redux store"}),A={unversionedId:"tutorials/fundamentals/part-4-store",id:"tutorials/fundamentals/part-4-store",isDocsHomePage:!1,title:"Redux Fundamentals, Part 4: Store",description:"The official Redux Fundamentals tutorial: learn how to create and use a Redux store",source:"@site/../docs/tutorials/fundamentals/part-4-store.md",sourceDirName:"tutorials/fundamentals",slug:"/tutorials/fundamentals/part-4-store",permalink:"/redux-in-chinese/tutorials/fundamentals/part-4-store",version:"current",sidebar_label:"Store",frontMatter:{id:"part-4-store",title:"Redux Fundamentals, Part 4: Store",sidebar_label:"Store",hide_title:!1,description:"The official Redux Fundamentals tutorial: learn how to create and use a Redux store"},sidebar:"docs",previous:{title:"Redux Fundamentals, Part 3: State, Actions, and Reducers",permalink:"/redux-in-chinese/tutorials/fundamentals/part-3-state-actions-reducers"},next:{title:"Redux Fundamentals, Part 5: UI and React",permalink:"/redux-in-chinese/tutorials/fundamentals/part-5-ui-react"}},s=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",children:[]},{value:"Redux Store",id:"redux-store",children:[{value:"Creating a Store",id:"creating-a-store",children:[]},{value:"Loading Initial State",id:"loading-initial-state",children:[]}]},{value:"Dispatching Actions",id:"dispatching-actions",children:[]},{value:"Inside a Redux Store",id:"inside-a-redux-store",children:[]},{value:"Configuring the Store",id:"configuring-the-store",children:[{value:"Creating a Store with Enhancers",id:"creating-a-store-with-enhancers",children:[]}]},{value:"Middleware",id:"middleware",children:[{value:"Using Middleware",id:"using-middleware",children:[]},{value:"Writing Custom Middleware",id:"writing-custom-middleware",children:[]},{value:"Your First Custom Middleware",id:"your-first-custom-middleware",children:[]},{value:"Middleware Use Cases",id:"middleware-use-cases",children:[]}]},{value:"Redux DevTools",id:"redux-devtools",children:[{value:"Adding the DevTools to the Store",id:"adding-the-devtools-to-the-store",children:[]}]},{value:"\u4f60\u5b66\u5230\u4e86",id:"\u4f60\u5b66\u5230\u4e86",children:[]},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",children:[]}],l={toc:s};function d(e){var t=e.components,o=(0,i.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,n.Z)({},l,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u4f60\u5c06\u5b66\u5230")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"How to create a Redux store"),(0,r.kt)("li",{parentName:"ul"},"How to use the store to update state and listen for updates"),(0,r.kt)("li",{parentName:"ul"},"How to configure the store to extend its capabilities"),(0,r.kt)("li",{parentName:"ul"},"How to set up the Redux DevTools Extension to debug your app")))),(0,r.kt)("h2",{id:"\u7b80\u4ecb"},"\u7b80\u4ecb"),(0,r.kt)("p",null,"In ",(0,r.kt)("a",{parentName:"p",href:"/redux-in-chinese/tutorials/fundamentals/part-3-state-actions-reducers"},"Part 3: State, Actions, and Reducers"),", we started writing our example todo app. We\nlisted business requirements, defined the ",(0,r.kt)("strong",{parentName:"p"},"state"),' structure we need to make the app work, and created a series of action types\nto describe "what happened" and match the kinds of events that can happen as a user interacts with our app. We also wrote ',(0,r.kt)("strong",{parentName:"p"},"reducer")," functions that can handle updating our ",(0,r.kt)("inlineCode",{parentName:"p"},"state.todos")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"state.filters")," sections, and saw how we can use the Redux ",(0,r.kt)("inlineCode",{parentName:"p"},"combineReducers"),' function\nto create a "root reducer" based on the different "slice reducers" for each feature in our app.'),(0,r.kt)("p",null,"Now, it's time to pull those pieces together, with the central piece of a Redux app: the ",(0,r.kt)("strong",{parentName:"p"},"store"),"."),(0,r.kt)("h2",{id:"redux-store"},"Redux Store"),(0,r.kt)("p",null,"The Redux ",(0,r.kt)("strong",{parentName:"p"},"store")," brings together the state, actions, and reducers that make up your app. The store has several responsibilities:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Holds the current application state inside"),(0,r.kt)("li",{parentName:"ul"},"Allows access to the current state via ",(0,r.kt)("a",{parentName:"li",href:"/redux-in-chinese/api/store#getState"},(0,r.kt)("inlineCode",{parentName:"a"},"store.getState()")),";"),(0,r.kt)("li",{parentName:"ul"},"Allows state to be updated via ",(0,r.kt)("a",{parentName:"li",href:"/redux-in-chinese/api/store#dispatch"},(0,r.kt)("inlineCode",{parentName:"a"},"store.dispatch(action)")),";"),(0,r.kt)("li",{parentName:"ul"},"Registers listener callbacks via ",(0,r.kt)("a",{parentName:"li",href:"/redux-in-chinese/api/store#subscribe"},(0,r.kt)("inlineCode",{parentName:"a"},"store.subscribe(listener)")),";"),(0,r.kt)("li",{parentName:"ul"},"Handles unregistering of listeners via the ",(0,r.kt)("inlineCode",{parentName:"li"},"unsubscribe")," function returned by ",(0,r.kt)("a",{parentName:"li",href:"/redux-in-chinese/api/store#subscribe"},(0,r.kt)("inlineCode",{parentName:"a"},"store.subscribe(listener)")),".")),(0,r.kt)("p",null,"It's important to note that ",(0,r.kt)("strong",{parentName:"p"},"you'll only have a single store in a Redux application"),". When you want to split your data handling logic, you'll use ",(0,r.kt)("a",{parentName:"p",href:"/redux-in-chinese/tutorials/fundamentals/part-3-state-actions-reducers#splitting-reducers"},"reducer composition")," and create multiple reducers that\ncan be combined together, instead of creating separate stores."),(0,r.kt)("h3",{id:"creating-a-store"},"Creating a Store"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Every Redux store has a single root reducer function"),". In the previous section, we ",(0,r.kt)("a",{parentName:"p",href:"/redux-in-chinese/tutorials/fundamentals/part-3-state-actions-reducers#combinereducers"},"created a root reducer function using ",(0,r.kt)("inlineCode",{parentName:"a"},"combineReducers")),". That root reducer is currently defined in ",(0,r.kt)("inlineCode",{parentName:"p"},"src/reducer.js")," in our example app. Let's import that root reducer and create our first store."),(0,r.kt)("p",null,"The Redux core library has ",(0,r.kt)("a",{parentName:"p",href:"/redux-in-chinese/api/createstore"},(0,r.kt)("strong",{parentName:"a"},"a ",(0,r.kt)("inlineCode",{parentName:"strong"},"createStore")," API"))," that will create the store. Add a new file\ncalled ",(0,r.kt)("inlineCode",{parentName:"p"},"store.js"),", and import ",(0,r.kt)("inlineCode",{parentName:"p"},"createStore")," and the root reducer. Then, call ",(0,r.kt)("inlineCode",{parentName:"p"},"createStore")," and pass in the root reducer:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/store.js"',title:'"src/store.js"'},"import { createStore } from 'redux'\nimport rootReducer from './reducer'\n\n// highlight-next-line\nconst store = createStore(rootReducer)\n\nexport default store\n")),(0,r.kt)("h3",{id:"loading-initial-state"},"Loading Initial State"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"createStore")," can also accept a ",(0,r.kt)("inlineCode",{parentName:"p"},"preloadedState")," value as its second argument. You could use this to add\ninitial data when the store is created, such as values that were included in an HTML page sent from the server, or persisted in\n",(0,r.kt)("inlineCode",{parentName:"p"},"localStorage")," and read back when the user visits the page again, like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="storeStatePersistenceExample.js"',title:'"storeStatePersistenceExample.js"'},"import { createStore } from 'redux'\nimport rootReducer from './reducer'\n\n// highlight-start\nlet preloadedState\nconst persistedTodosString = localStorage.getItem('todos')\n\nif (persistedTodosString) {\n  preloadedState = {\n    todos: JSON.parse(persistedTodosString)\n  }\n}\n\nconst store = createStore(rootReducer, preloadedState)\n// highlight-end\n")),(0,r.kt)("h2",{id:"dispatching-actions"},"Dispatching Actions"),(0,r.kt)("p",null,"Now that we have created a store, let's verify our program works! Even without any UI, we can already test the update logic."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Before you run this code, try going back to ",(0,r.kt)("inlineCode",{parentName:"p"},"src/features/todos/todosSlice.js"),", and remove all the example todo objects from the ",(0,r.kt)("inlineCode",{parentName:"p"},"initialState")," so that it's an empty array. That will make the output from this example a bit easier to read."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/index.js"',title:'"src/index.js"'},"// Omit existing React imports\n\nimport store from './store'\n\n// Log the initial state\n// highlight-next-line\nconsole.log('Initial state: ', store.getState())\n// {todos: [....], filters: {status, colors}}\n\n// Every time the state changes, log it\n// Note that subscribe() returns a function for unregistering the listener\n// highlight-start\nconst unsubscribe = store.subscribe(() =>\n  console.log('State after dispatch: ', store.getState())\n)\n// highlight-end\n\n// Now, dispatch some actions\n\n// highlight-next-line\nstore.dispatch({ type: 'todos/todoAdded', payload: 'Learn about actions' })\nstore.dispatch({ type: 'todos/todoAdded', payload: 'Learn about reducers' })\nstore.dispatch({ type: 'todos/todoAdded', payload: 'Learn about stores' })\n\nstore.dispatch({ type: 'todos/todoToggled', payload: 0 })\nstore.dispatch({ type: 'todos/todoToggled', payload: 1 })\n\nstore.dispatch({ type: 'filters/statusFilterChanged', payload: 'Active' })\n\nstore.dispatch({\n  type: 'filters/colorFilterChanged',\n  payload: { color: 'red', changeType: 'added' }\n})\n\n// Stop listening to state updates\n// highlight-next-line\nunsubscribe()\n\n// Dispatch one more action to see what happens\n\nstore.dispatch({ type: 'todos/todoAdded', payload: 'Try creating a store' })\n\n// Omit existing React rendering logic\n")),(0,r.kt)("p",null,"Remember, every time we call ",(0,r.kt)("inlineCode",{parentName:"p"},"store.dispatch(action)"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The store calls ",(0,r.kt)("inlineCode",{parentName:"li"},"rootReducer(state, action)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"That root reducer may call other slice reducers inside of itself, like ",(0,r.kt)("inlineCode",{parentName:"li"},"todosReducer(state.todos, action)")))),(0,r.kt)("li",{parentName:"ul"},"The store saves the ",(0,r.kt)("em",{parentName:"li"},"new")," state value inside"),(0,r.kt)("li",{parentName:"ul"},"The store calls all the listener subscription callbacks"),(0,r.kt)("li",{parentName:"ul"},"If a listener has access to the ",(0,r.kt)("inlineCode",{parentName:"li"},"store"),", it can now call ",(0,r.kt)("inlineCode",{parentName:"li"},"store.getState()")," to read the latest state value")),(0,r.kt)("p",null,"If we look at the console log output from that example, you can see how the\nRedux state changes as each action was dispatched:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Logged Redux state after dispatching actions",src:a(3312).Z})),(0,r.kt)("p",null,"Notice that our app did ",(0,r.kt)("em",{parentName:"p"},"not")," log anything from the last action. That's because we removed the listener callback when we called ",(0,r.kt)("inlineCode",{parentName:"p"},"unsubscribe()"),", so nothing else ran after the action was dispatched."),(0,r.kt)("p",null,"We specified the behavior of our app before we even started writing the UI. That\nhelps give us confidence that the app will work as intended."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you want, you can now try writing tests for your reducers. Because they're ",(0,r.kt)("a",{parentName:"p",href:"/redux-in-chinese/understanding/thinking-in-redux/three-principles#changes-are-made-with-pure-functions"},"pure functions"),", it should be straightforward to test them. Call them with an example ",(0,r.kt)("inlineCode",{parentName:"p"},"state")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"action"),",\ntake the result, and check to see if it matches what you expect:"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="todosSlice.spec.js"',title:'"todosSlice.spec.js"'},"import todosReducer from './todosSlice'\n\ntest('Toggles a todo based on id', () => {\n  const initialState = [{ id: 0, text: 'Test text', completed: false }]\n\n  const action = { type: 'todos/todoToggled', payload: 0 }\n  const result = todosReducer(initialState, action)\n  expect(result[0].completed).toBe(true)\n})\n")))),(0,r.kt)("h2",{id:"inside-a-redux-store"},"Inside a Redux Store"),(0,r.kt)("p",null,"It might be helpful to take a peek inside a Redux store to see how it works. Here's a miniature example of a working Redux store, in about 25 lines of code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="miniReduxStoreExample.js"',title:'"miniReduxStoreExample.js"'},"function createStore(reducer, preloadedState) {\n  let state = preloadedState\n  const listeners = []\n\n  function getState() {\n    return state\n  }\n\n  function subscribe(listener) {\n    listeners.push(listener)\n    return function unsubscribe() {\n      const index = listeners.indexOf(listener)\n      listeners.splice(index, 1)\n    }\n  }\n\n  function dispatch(action) {\n    state = reducer(state, action)\n    listeners.forEach(listener => listener())\n  }\n\n  dispatch({ type: '@@redux/INIT' })\n\n  return { dispatch, subscribe, getState }\n}\n")),(0,r.kt)("p",null,"This small version of a Redux store works well enough that you could use it to replace the actual Redux ",(0,r.kt)("inlineCode",{parentName:"p"},"createStore")," function you've been using in your app so far. (Try it and see for yourself!) ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux/blob/v4.0.5/src/createStore.js"},"The actual Redux store implementation is longer and a bit more complicated"),", but most of that is comments, warning messages, and handling some edge cases."),(0,r.kt)("p",null,"As you can see, the actual logic here is fairly short:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The store has the current ",(0,r.kt)("inlineCode",{parentName:"li"},"state")," value and ",(0,r.kt)("inlineCode",{parentName:"li"},"reducer")," function inside of itself"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getState")," returns the current state value"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"subscribe")," keeps an array of listener callbacks and returns a function to remove the new callback"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dispatch")," calls the reducer, saves the state, and runs the listeners"),(0,r.kt)("li",{parentName:"ul"},"The store dispatches one action on startup to initialize the reducers with their state"),(0,r.kt)("li",{parentName:"ul"},"The store API is an object with ",(0,r.kt)("inlineCode",{parentName:"li"},"{dispatch, subscribe, getState}")," inside")),(0,r.kt)("p",null,"To emphasize one of those in particular: notice that ",(0,r.kt)("inlineCode",{parentName:"p"},"getState")," just returns whatever the current ",(0,r.kt)("inlineCode",{parentName:"p"},"state")," value is. That means that ",(0,r.kt)("strong",{parentName:"p"},"by default, nothing prevents you from accidentally mutating the current state value!")," This code will run without any errors, but it's incorrect:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const state = store.getState()\n// \u274c Don't do this - it mutates the current state!\nstate.filters.status = 'Active'\n")),(0,r.kt)("p",null,"In other words:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The Redux store doesn't make an extra copy of the ",(0,r.kt)("inlineCode",{parentName:"li"},"state")," value when you call ",(0,r.kt)("inlineCode",{parentName:"li"},"getState()"),". It's exactly the same reference that was returned from the root reducer function"),(0,r.kt)("li",{parentName:"ul"},"The Redux store doesn't do anything else to prevent accidental mutations. It ",(0,r.kt)("em",{parentName:"li"},"is")," possible to mutate the state, either inside a reducer or outside the store, and you must always be careful to avoid mutations.")),(0,r.kt)("p",null,"One common cause of accidental mutations is sorting arrays. ",(0,r.kt)("a",{parentName:"p",href:"https://doesitmutate.xyz/sort/"},(0,r.kt)("strong",{parentName:"a"},"Calling ",(0,r.kt)("inlineCode",{parentName:"strong"},"array.sort()")," actually mutates the existing array")),". If we called ",(0,r.kt)("inlineCode",{parentName:"p"},"const sortedTodos = state.todos.sort()"),", we'd end up mutating the real store state unintentionally."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"In ",(0,r.kt)("a",{parentName:"p",href:"/redux-in-chinese/tutorials/fundamentals/part-8-modern-redux"},"Part 8: Modern Redux"),", we'll see how Redux Toolkit helps avoid mutations in reducers, and detects and warns about accidental mutations outside of reducers."))),(0,r.kt)("h2",{id:"configuring-the-store"},"Configuring the Store"),(0,r.kt)("p",null,"We've already seen that we can pass ",(0,r.kt)("inlineCode",{parentName:"p"},"rootReducer")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"preloadedState")," arguments to ",(0,r.kt)("inlineCode",{parentName:"p"},"createStore"),". However, ",(0,r.kt)("inlineCode",{parentName:"p"},"createStore")," can also take one more argument, which is used to customize the store's abilities and give it new powers."),(0,r.kt)("p",null,"Redux stores are customized using something called a ",(0,r.kt)("strong",{parentName:"p"},"store enhancer"),". A store enhancer is like a special version of ",(0,r.kt)("inlineCode",{parentName:"p"},"createStore")," that adds another layer wrapping around the original Redux store. An enhanced store can then change how the store behaves, by supplying its own versions of the store's ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"getState"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"subscribe")," functions instead of the originals."),(0,r.kt)("p",null,"For this tutorial, we won't go into details about how store enhancers actually work - we'll focus on how to use them."),(0,r.kt)("h3",{id:"creating-a-store-with-enhancers"},"Creating a Store with Enhancers"),(0,r.kt)("p",null,"Our project has two small example store enhancers available, in the ",(0,r.kt)("inlineCode",{parentName:"p"},"src/exampleAddons/enhancers.js")," file:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sayHiOnDispatch"),": an enhancer that always logs ",(0,r.kt)("inlineCode",{parentName:"li"},"'Hi'!")," to the console every time an action is dispatched"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"includeMeaningOfLife"),": an enhancer that always adds the field ",(0,r.kt)("inlineCode",{parentName:"li"},"meaningOfLife: 42")," to the value returned from ",(0,r.kt)("inlineCode",{parentName:"li"},"getState()"))),(0,r.kt)("p",null,"Let's start by using ",(0,r.kt)("inlineCode",{parentName:"p"},"sayHiOnDispatch"),". First, we'll import it, and pass it to ",(0,r.kt)("inlineCode",{parentName:"p"},"createStore"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/store.js"',title:'"src/store.js"'},"import { createStore } from 'redux'\nimport rootReducer from './reducer'\nimport { sayHiOnDispatch } from './exampleAddons/enhancers'\n\nconst store = createStore(rootReducer, undefined, sayHiOnDispatch)\n\nexport default store\n")),(0,r.kt)("p",null,"We don't have a ",(0,r.kt)("inlineCode",{parentName:"p"},"preloadedState")," value here, so we'll pass ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined")," as the second argument instead."),(0,r.kt)("p",null,"Next, let's try dispatching an action:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/index.js"',title:'"src/index.js"'},"import store from './store'\n\n// highlight-start\nconsole.log('Dispatching action')\nstore.dispatch({ type: 'todos/todoAdded', payload: 'Learn about actions' })\nconsole.log('Dispatch complete')\n// highlight-end\n")),(0,r.kt)("p",null,"Now look at the console. You should see ",(0,r.kt)("inlineCode",{parentName:"p"},"'Hi!'")," logged there, in between the other two log statements:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"sayHi store enhancer logging",src:a(1632).Z})),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"sayHiOnDispatch")," enhancer wrapped the original ",(0,r.kt)("inlineCode",{parentName:"p"},"store.dispatch")," function with its own specialized version of ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch"),". When we called ",(0,r.kt)("inlineCode",{parentName:"p"},"store.dispatch()"),", we were actually calling the wrapper function from ",(0,r.kt)("inlineCode",{parentName:"p"},"sayHiOnDispatch"),", which called the original and then printed 'Hi'."),(0,r.kt)("p",null,"Now, let's try adding a second enhancer. We can import ",(0,r.kt)("inlineCode",{parentName:"p"},"includeMeaningOfLife")," from that same file... but we have a problem. ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"createStore")," only accepts one enhancer as its third argument!")," How can we pass ",(0,r.kt)("em",{parentName:"p"},"two")," enhancers at the same time?"),(0,r.kt)("p",null,"What we really need is some way to merge both the ",(0,r.kt)("inlineCode",{parentName:"p"},"sayHiOnDispatch")," enhancer and the ",(0,r.kt)("inlineCode",{parentName:"p"},"includeMeaningOfLife")," enhancer into a single combined enhancer, and then pass that instead."),(0,r.kt)("p",null,"Fortunately, ",(0,r.kt)("strong",{parentName:"p"},"the Redux core includes ",(0,r.kt)("a",{parentName:"strong",href:"/redux-in-chinese/api/compose"},"a ",(0,r.kt)("inlineCode",{parentName:"a"},"compose")," function")," that can be used to merge multiple enhancers together"),". Let's use that here:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/store.js"',title:'"src/store.js"'},"// highlight-next-line\nimport { createStore, compose } from 'redux'\nimport rootReducer from './reducer'\nimport {\n  sayHiOnDispatch,\n  includeMeaningOfLife\n} from './exampleAddons/enhancers'\n\n// highlight-next-line\nconst composedEnhancer = compose(sayHiOnDispatch, includeMeaningOfLife)\n\n// highlight-next-line\nconst store = createStore(rootReducer, undefined, composedEnhancer)\n\nexport default store\n")),(0,r.kt)("p",null,"Now we can see what happens if we use the store:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/index.js"',title:'"src/index.js"'},"import store from './store'\n\nstore.dispatch({ type: 'todos/todoAdded', payload: 'Learn about actions' })\n// log: 'Hi!'\n\nconsole.log('State after dispatch: ', store.getState())\n// log: {todos: [...], filters: {status, colors}, meaningOfLife: 42}\n")),(0,r.kt)("p",null,"And the logged output looks like this:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"meaningOfLife store enhancer logging",src:a(3113).Z})),(0,r.kt)("p",null,"So, we can see that both enhancers are modifying the behavior of the store at the same time. ",(0,r.kt)("inlineCode",{parentName:"p"},"sayHiOnDispatch")," has changed how ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch")," works, and ",(0,r.kt)("inlineCode",{parentName:"p"},"includeMeaningOfLife")," has changed how ",(0,r.kt)("inlineCode",{parentName:"p"},"getState")," works."),(0,r.kt)("p",null,"Store enhancers are a very powerful way to modify the store, and almost all Redux apps will include at least one enhancer when setting up the store."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you don't have any ",(0,r.kt)("inlineCode",{parentName:"p"},"preloadedState")," to pass in, you can pass the ",(0,r.kt)("inlineCode",{parentName:"p"},"enhancer")," as the second argument instead:"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const store = createStore(rootReducer, storeEnhancer)\n")))),(0,r.kt)("h2",{id:"middleware"},"Middleware"),(0,r.kt)("p",null,"Enhancers are powerful because they can override or replace any of the store's methods: ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"getState"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"subscribe"),"."),(0,r.kt)("p",null,"But, much of the time, we only need to customize how ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch")," behaves. It would be nice if there was a way to add some customized behavior when ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch")," runs."),(0,r.kt)("p",null,"Redux uses a special kind of addon called ",(0,r.kt)("strong",{parentName:"p"},"middleware")," to let us customize the ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch")," function."),(0,r.kt)("p",null,"If you've ever used a library like Express or Koa, you might already be familiar with the idea of adding middleware to customize behavior. In these frameworks, middleware is some code you can put between the framework receiving a request, and the framework generating a response. For example, Express or Koa middleware may add CORS headers, logging, compression, and more. The best feature of middleware is that it's composable in a chain. You can use multiple independent third-party middleware in a single project."),(0,r.kt)("p",null,"Redux middleware solves different problems than Express or Koa middleware, but in a conceptually similar way. ",(0,r.kt)("strong",{parentName:"p"},"Redux middleware provides a third-party extension point between dispatching an action, and the moment it reaches the reducer.")," People use Redux middleware for logging, crash reporting, talking to an asynchronous API, routing, and more."),(0,r.kt)("p",null,"First, we'll look at how to add middleware to the store, then we'll show how you can write your own."),(0,r.kt)("h3",{id:"using-middleware"},"Using Middleware"),(0,r.kt)("p",null,"We already saw that you can customize a Redux store using store enhancers. Redux middleware are actually implemented on top of a very special store enhancer that comes built in with Redux, called ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"applyMiddleware")),"."),(0,r.kt)("p",null,"Since we already know how to add enhancers to our store, we should be able to do that now. We'll start with ",(0,r.kt)("inlineCode",{parentName:"p"},"applyMiddleware")," by itself, and we'll add three example middleware that have been included in this project."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/store.js"',title:'"src/store.js"'},"import { createStore, applyMiddleware } from 'redux'\nimport rootReducer from './reducer'\nimport { print1, print2, print3 } from './exampleAddons/middleware'\n\nconst middlewareEnhancer = applyMiddleware(print1, print2, print3)\n\n// Pass enhancer as the second arg, since there's no preloadedState\nconst store = createStore(rootReducer, middlewareEnhancer)\n\nexport default store\n")),(0,r.kt)("p",null,"As their names say, each of these middleware will print a number when an action is dispatched."),(0,r.kt)("p",null,"What happens if we dispatch now?"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/index.js"',title:'"src/index.js"'},"import store from './store'\n\nstore.dispatch({ type: 'todos/todoAdded', payload: 'Learn about actions' })\n// log: '1'\n// log: '2'\n// log: '3'\n")),(0,r.kt)("p",null,"And we can see the output in the console:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"print middleware logging",src:a(9211).Z})),(0,r.kt)("p",null,"So how does that work?"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Middleware form a pipeline around the store's ",(0,r.kt)("inlineCode",{parentName:"strong"},"dispatch")," method"),". When we call ",(0,r.kt)("inlineCode",{parentName:"p"},"store.dispatch(action)"),", we're ",(0,r.kt)("em",{parentName:"p"},"actually")," calling the first middleware in the pipeline. That middleware can then do anything it wants when it sees the action. Typically, a middleware will check to see if the action is a specific type that it cares about, much like a reducer would. If it's the right type, the middleware might run some custom logic. Otherwise, it passes the action to the next middleware in the pipeline."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Unlike")," a reducer, ",(0,r.kt)("strong",{parentName:"p"},"middleware can have side effects inside"),", including timeouts and other async logic."),(0,r.kt)("p",null,"In this case, the action is passed through:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"print1")," middleware (which we see as ",(0,r.kt)("inlineCode",{parentName:"li"},"store.dispatch"),")"),(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"print2")," middleware"),(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"print3")," middleware"),(0,r.kt)("li",{parentName:"ol"},"The original ",(0,r.kt)("inlineCode",{parentName:"li"},"store.dispatch")),(0,r.kt)("li",{parentName:"ol"},"The root reducer inside ",(0,r.kt)("inlineCode",{parentName:"li"},"store"))),(0,r.kt)("p",null,"And since these are all function calls, they all ",(0,r.kt)("em",{parentName:"p"},"return")," from that call stack. So, the ",(0,r.kt)("inlineCode",{parentName:"p"},"print1")," middleware is the first to run, and the last to finish."),(0,r.kt)("h3",{id:"writing-custom-middleware"},"Writing Custom Middleware"),(0,r.kt)("p",null,"We can also write our own middleware. You might not need to do this all the time, but custom middleware are a great way to add specific behaviors to a Redux application."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Redux middleware are written as a series of three nested functions"),". Let's see what that pattern looks like. We'll start by trying to write this middleware using the ",(0,r.kt)("inlineCode",{parentName:"p"},"function")," keyword, so that it's more clear what's happening:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// Middleware written as ES5 functions\n\n// Outer function:\nfunction exampleMiddleware(storeAPI) {\n  return function wrapDispatch(next) {\n    return function handleAction(action) {\n      // Do anything here: pass the action onwards with next(action),\n      // or restart the pipeline with storeAPI.dispatch(action)\n      // Can also use storeAPI.getState() here\n\n      return next(action)\n    }\n  }\n}\n")),(0,r.kt)("p",null,"Let's break down what these three functions do and what their arguments are."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"exampleMiddleware"),': The outer function is actually the "middleware" itself. It will be called by ',(0,r.kt)("inlineCode",{parentName:"li"},"applyMiddleware"),", and receives a ",(0,r.kt)("inlineCode",{parentName:"li"},"storeAPI")," object containing the store's ",(0,r.kt)("inlineCode",{parentName:"li"},"{dispatch, getState}")," functions. These are the same ",(0,r.kt)("inlineCode",{parentName:"li"},"dispatch")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"getState")," functions that are actually part of the store. If you call this ",(0,r.kt)("inlineCode",{parentName:"li"},"dispatch")," function, it will send the action to the ",(0,r.kt)("em",{parentName:"li"},"start")," of the middleware pipeline. This is only called once."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"wrapDispatch"),": The middle function receives a function called ",(0,r.kt)("inlineCode",{parentName:"li"},"next")," as its argument. This function is actually the ",(0,r.kt)("em",{parentName:"li"},"next middleware")," in the pipeline. If this middleware is the last one in the sequence, then ",(0,r.kt)("inlineCode",{parentName:"li"},"next")," is actually the original ",(0,r.kt)("inlineCode",{parentName:"li"},"store.dispatch")," function instead. Calling ",(0,r.kt)("inlineCode",{parentName:"li"},"next(action)")," passes the middleware to the ",(0,r.kt)("em",{parentName:"li"},"next")," middleware in the pipeline. This is also only called once"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"handleAction"),": Finally, the inner function receives the current ",(0,r.kt)("inlineCode",{parentName:"li"},"action")," as its argument, and will be called ",(0,r.kt)("em",{parentName:"li"},"every")," time an action is dispatched.")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can give these middleware functions any names you want, but it can help to use these names to remember what each one does:"),(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"Outer: ",(0,r.kt)("inlineCode",{parentName:"li"},"someCustomMiddleware")," (or whatever your middleware is called)"),(0,r.kt)("li",{parentName:"ul"},"Middle: ",(0,r.kt)("inlineCode",{parentName:"li"},"wrapDispatch")),(0,r.kt)("li",{parentName:"ul"},"Inner: ",(0,r.kt)("inlineCode",{parentName:"li"},"handleAction"))))),(0,r.kt)("p",null,"Because these are normal functions, we can also write them using ES6 arrow functions. This lets us write them shorter because arrow functions don't have to have a ",(0,r.kt)("inlineCode",{parentName:"p"},"return")," statement, but it can also be a bit harder to read if you're not yet familiar with arrow functions and implicit returns."),(0,r.kt)("p",null,"Here's the same example as above, using arrow functions:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const anotherExampleMiddleware = storeAPI => next => action => {\n  // Do something in here, when each action is dispatched\n\n  return next(action)\n}\n")),(0,r.kt)("p",null,"We're still nesting those three functions together, and returning each function, but the implicit returns make this shorter."),(0,r.kt)("h3",{id:"your-first-custom-middleware"},"Your First Custom Middleware"),(0,r.kt)("p",null,"Let's say we want to add some logging to our application. We'd like to see the contents of each action in the console when it's dispatched, and we'd like to see what the state is after the action has been handled by the reducers."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"These example middleware aren't specifically part of the actual todo app, but you can try adding them to your project to see what happens when you use them."))),(0,r.kt)("p",null,"We can write a small middleware that will log that information to the console for us:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const loggerMiddleware = storeAPI => next => action => {\n  console.log('dispatching', action)\n  let result = next(action)\n  console.log('next state', storeAPI.getState())\n  return result\n}\n")),(0,r.kt)("p",null,"Whenever an action is dispatched:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The first part of the ",(0,r.kt)("inlineCode",{parentName:"li"},"handleAction")," function runs, and we print ",(0,r.kt)("inlineCode",{parentName:"li"},"'dispatching'")),(0,r.kt)("li",{parentName:"ul"},"We pass the action to the ",(0,r.kt)("inlineCode",{parentName:"li"},"next")," section, which may be another middleware or the real ",(0,r.kt)("inlineCode",{parentName:"li"},"store.dispatch")),(0,r.kt)("li",{parentName:"ul"},"Eventually the reducers run and the state is updated, and the ",(0,r.kt)("inlineCode",{parentName:"li"},"next")," function returns"),(0,r.kt)("li",{parentName:"ul"},"We can now call ",(0,r.kt)("inlineCode",{parentName:"li"},"storeAPI.getState()")," and see what the new state is"),(0,r.kt)("li",{parentName:"ul"},"We finish by returning whatever ",(0,r.kt)("inlineCode",{parentName:"li"},"result")," value came from the ",(0,r.kt)("inlineCode",{parentName:"li"},"next")," middleware")),(0,r.kt)("p",null,"Any middleware can return any value, and the return value from the first middleware in the pipeline is actually returned when you call ",(0,r.kt)("inlineCode",{parentName:"p"},"store.dispatch()"),". For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const alwaysReturnHelloMiddleware = storeAPI => next => action {\n  const originalResult = next(action);\n  // Ignore the original result, return something else\n  return 'Hello!'\n}\n\nconst middlewareEnhancer = applyMiddleware(alwaysReturnHelloMiddleware)\nconst store = createStore(rootReducer, middlewareEnhancer)\n\nconst dispatchResult = store.dispatch({type: 'some/action'})\nconsole.log(dispatchResult)\n// log: 'Hello!'\n")),(0,r.kt)("p",null,"Let's try one more example. Middleware often look for a specific action, and then do something when that action is dispatched. Middleware also have the ability to run async logic inside. We can write a middleware that prints something on a delay when it sees a certain action:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const delayedMessageMiddleware = storeAPI => next => action => {\n  if (action.type === 'todos/todoAdded') {\n    setTimeout(() => {\n      console.log('Added a new todo: ', action.payload)\n    }, 1000)\n  }\n\n  return next(action)\n}\n")),(0,r.kt)("p",null,'This middleware will look for "todo added" actions. Every time it sees one, it sets a 1-second timer, and then prints the action\'s payload to the console.'),(0,r.kt)("h3",{id:"middleware-use-cases"},"Middleware Use Cases"),(0,r.kt)("p",null,"So, what can we do with middleware? Lots of things!"),(0,r.kt)("p",null,"A middleware can do anything it wants when it sees a dispatched action:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Log something to the console"),(0,r.kt)("li",{parentName:"ul"},"Set timeouts"),(0,r.kt)("li",{parentName:"ul"},"Make asynchronous API calls"),(0,r.kt)("li",{parentName:"ul"},"Modify the action"),(0,r.kt)("li",{parentName:"ul"},"Pause the action or even stop it entirely")),(0,r.kt)("p",null,"and anything else you can think of."),(0,r.kt)("p",null,"In particular, ",(0,r.kt)("strong",{parentName:"p"},"middleware are ",(0,r.kt)("em",{parentName:"strong"},"intended")," to contain logic with side effects"),". In addition, ",(0,r.kt)("strong",{parentName:"p"},"middleware can modify ",(0,r.kt)("inlineCode",{parentName:"strong"},"dispatch")," to accept things that are ",(0,r.kt)("em",{parentName:"strong"},"not")," plain action objects"),". We'll talk more about both of these ",(0,r.kt)("a",{parentName:"p",href:"/redux-in-chinese/tutorials/fundamentals/part-6-async-logic"},"in Part 6: Async Logic"),"."),(0,r.kt)("h2",{id:"redux-devtools"},"Redux DevTools"),(0,r.kt)("p",null,"Finally, there's one more very important thing to cover with configuring the store."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Redux was specifically designed to make it easier to understand when, where, why, and how your state has changed over time"),". As part of that, Redux was built to enable the use of the ",(0,r.kt)("strong",{parentName:"p"},"Redux DevTools")," - an addon that shows you a history of what actions were dispatched, what those actions contained, and how the state changed after each dispatched action."),(0,r.kt)("p",null,"The Redux DevTools UI is available as a browser extension for ",(0,r.kt)("a",{parentName:"p",href:"https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=en"},"Chrome")," and ",(0,r.kt)("a",{parentName:"p",href:"https://addons.mozilla.org/en-US/firefox/addon/reduxdevtools/"},"Firefox"),". If you haven't already added that to your browser, go ahead and do that now."),(0,r.kt)("p",null,"Once that's installed, open up the browser's DevTools window. You should now see a new \"Redux\" tab there. It doesn't do anything, yet - we've got to set it up to talk to a Redux store first."),(0,r.kt)("h3",{id:"adding-the-devtools-to-the-store"},"Adding the DevTools to the Store"),(0,r.kt)("p",null,"Once the extension is installed, we need to configure the store so that the DevTools can see what's happening inside. The DevTools require a specific store enhancer to be added to make that possible."),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/zalmoxisus/redux-devtools-extension"},"Redux DevTools Extension docs")," have some instructions on how to set up the store, but the steps listed are a bit complicated. However, there's an NPM package called ",(0,r.kt)("inlineCode",{parentName:"p"},"redux-devtools-extension")," that takes care of the complicated part. That package exports a specialized ",(0,r.kt)("inlineCode",{parentName:"p"},"composeWithDevTools")," function that we can use instead of the original Redux ",(0,r.kt)("inlineCode",{parentName:"p"},"compose")," function."),(0,r.kt)("p",null,"Here's how that looks:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/store.js"',title:'"src/store.js"'},"import { createStore, applyMiddleware } from 'redux'\nimport { composeWithDevTools } from 'redux-devtools-extension'\nimport rootReducer from './reducer'\nimport { print1, print2, print3 } from './exampleAddons/middleware'\n\nconst composedEnhancer = composeWithDevTools(\n  // EXAMPLE: Add whatever middleware you actually want to use here\n  applyMiddleware(print1, print2, print3)\n  // other store enhancers if any\n)\n\nconst store = createStore(rootReducer, composedEnhancer)\nexport default store\n")),(0,r.kt)("p",null,"Make sure that ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," is still dispatching an action after importing the store. Now, open up the Redux DevTools tab in the browser's DevTools window. You should see something that looks like this:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Redux DevTools Extension: action tab",src:a(627).Z})),(0,r.kt)("p",null,"There's a list of dispatched actions on the left. If we click one of them, the right pane shows several tabs:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The contents of that action object"),(0,r.kt)("li",{parentName:"ul"},"The entire Redux state as it looked after the reducer ran"),(0,r.kt)("li",{parentName:"ul"},"The diff between the previous state and this state"),(0,r.kt)("li",{parentName:"ul"},"If enabled, the function stack trace leading back to the line of code that called ",(0,r.kt)("inlineCode",{parentName:"li"},"store.dispatch()")," in the first place")),(0,r.kt)("p",null,'Here\'s what the "State" and "Diff" tabs look like after we dispatched that "add todo" action:'),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Redux DevTools Extension: state tab",src:a(3695).Z})),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Redux DevTools Extension: diff tab",src:a(3405).Z})),(0,r.kt)("p",null,"These are very powerful tools that can help us debug our apps and understand exactly what's happening inside."),(0,r.kt)("h2",{id:"\u4f60\u5b66\u5230\u4e86"},"\u4f60\u5b66\u5230\u4e86"),(0,r.kt)("p",null,"As you've seen, the store is the central piece of every Redux application. Stores contain state and handle actions by running reducers, and can be customized to add additional behaviors."),(0,r.kt)("p",null,"Let's see how our example app looks now:"),(0,r.kt)("iframe",{class:"codesandbox",src:"https://codesandbox.io/embed/github/reduxjs/redux-fundamentals-example-app/tree/checkpoint-2-storeSetup/?fontsize=14&hidenavigation=1&theme=dark&module=%2Fsrc%2Fstore.js&runonclick=1",title:"redux-fundamentals-example-app",allow:"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"}),(0,r.kt)("p",null,"And as a reminder, here's what we covered in this section:"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u603b\u7ed3")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Redux apps always have a single store"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Stores are created with the Redux ",(0,r.kt)("inlineCode",{parentName:"li"},"createStore")," API"),(0,r.kt)("li",{parentName:"ul"},"Every store has a single root reducer function"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Stores have three main methods"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getState")," returns the current state"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dispatch")," sends an action to the reducer to update the state"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"subscribe")," takes a listener callback that runs each time an action is dispatched"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Store enhancers let us customize the store when it's created"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Enhancers wrap the store and can override its methods"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"createStore")," accepts one enhancer as an argument"),(0,r.kt)("li",{parentName:"ul"},"Multiple enhancers can be merged together using the ",(0,r.kt)("inlineCode",{parentName:"li"},"compose")," API"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Middleware are the main way to customize the store"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Middleware are added using the ",(0,r.kt)("inlineCode",{parentName:"li"},"applyMiddleware")," enhancer"),(0,r.kt)("li",{parentName:"ul"},"Middleware are written as three nested functions inside each other"),(0,r.kt)("li",{parentName:"ul"},"Middleware run each time an action is dispatched"),(0,r.kt)("li",{parentName:"ul"},"Middleware can have side effects inside"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"The Redux DevTools let you see what's changed in your app over time"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The DevTools Extension can be installed in your browser"),(0,r.kt)("li",{parentName:"ul"},"The store needs the DevTools enhancer added, using ",(0,r.kt)("inlineCode",{parentName:"li"},"composeWithDevTools")),(0,r.kt)("li",{parentName:"ul"},"The DevTools show dispatched actions and changes in state over time")))))),(0,r.kt)("h2",{id:"\u4e0b\u4e00\u6b65"},"\u4e0b\u4e00\u6b65"),(0,r.kt)("p",null,"We now have a working Redux store that can run our reducers and update the state when we dispatch actions."),(0,r.kt)("p",null,"However, every app needs a user interface to display the data and let the user do something useful. In ",(0,r.kt)("a",{parentName:"p",href:"/redux-in-chinese/tutorials/fundamentals/part-5-ui-react"},"Part 5: UI and React"),", we'll see how the Redux store works with a UI, and specifically see how Redux can work together with React."))}d.isMDXComponent=!0},627:function(e,t,a){"use strict";t.Z=a.p+"assets/images/devtools-action-tab-d48da9ccb10f938ecc9d520555dbfe62.png"},3405:function(e,t,a){"use strict";t.Z=a.p+"assets/images/devtools-diff-tab-e234146194236a6f6a31a0dde5d49836.png"},3695:function(e,t,a){"use strict";t.Z=a.p+"assets/images/devtools-state-tab-7029c0b4cfd3047e4bca2e9684d24555.png"},3312:function(e,t,a){"use strict";t.Z=a.p+"assets/images/initial-state-updates-67635eb69036940412b749502d6f1e55.png"},3113:function(e,t,a){"use strict";t.Z=a.p+"assets/images/meaningOfLife-enhancer-logging-46b98c1363a85b3657bd6e60599ad425.png"},9211:function(e,t){"use strict";t.Z="data:image/png;base64,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"},1632:function(e,t){"use strict";t.Z="data:image/png;base64,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"}}]);